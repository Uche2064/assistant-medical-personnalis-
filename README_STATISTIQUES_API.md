# API Statistiques - Documentation Frontend

Ce document d√©taille toutes les routes de statistiques disponibles dans l'API pour permettre au frontend de concevoir les interfaces appropri√©es.

## Base URL
```
https://api.sunusante.com/api/v1
```

## Authentification
Toutes les routes n√©cessitent une authentification JWT. Incluez le token dans le header :
```
Authorization: Bearer {token}
```

---

## üìä Statistiques des Gestionnaires

### Route
```
GET /admin/gestionnaires/stats
```

### Acc√®s
- **R√¥le requis** : `admin_global`
- **Middleware** : `auth:api`, `checkRole:admin_global`

### R√©ponse
```json
{
  "success": true,
  "message": "Statistiques des gestionnaires r√©cup√©r√©es avec succ√®s",
  "data": {
    "total": 15,
    "actifs": 12,
    "inactifs": 3,
    "repartition_par_sexe": {
      "M": 8,
      "F": 6,
      "Non sp√©cifi√©": 1
    }
  }
}
```

### Structure des donn√©es
| Champ | Type | Description |
|-------|------|-------------|
| `total` | integer | Nombre total de gestionnaires |
| `actifs` | integer | Nombre de gestionnaires actifs |
| `inactifs` | integer | Nombre de gestionnaires inactifs |
| `repartition_par_sexe` | object | R√©partition par sexe (M/F/Non sp√©cifi√©) |

---

## üë• Statistiques des Personnels

### Route
```
GET /gestionnaire/personnels/stats
```

### Acc√®s
- **R√¥le requis** : `gestionnaire`
- **Middleware** : `auth:api`, `checkRole:gestionnaire`

### R√©ponse
```json
{
  "success": true,
  "message": "Statistiques des personnels r√©cup√©r√©es avec succ√®s",
  "data": {
    "total": 45,
    "actifs": 38,
    "inactifs": 7,
    "repartition_par_role": {
      "technicien": 20,
      "medecin_controleur": 10,
      "comptable": 8,
      "commercial": 7
    },
    "repartition_par_sexe": {
      "M": 25,
      "F": 18,
      "Non sp√©cifi√©": 2
    }
  }
}
```

### Structure des donn√©es
| Champ | Type | Description |
|-------|------|-------------|
| `total` | integer | Nombre total de personnels |
| `actifs` | integer | Nombre de personnels actifs |
| `inactifs` | integer | Nombre de personnels inactifs |
| `repartition_par_role` | object | R√©partition par r√¥le (technicien, medecin_controleur, comptable, commercial) |
| `repartition_par_sexe` | object | R√©partition par sexe (M/F/Non sp√©cifi√©) |

---

## ‚ùì Statistiques des Questions

### Route
```
GET /questions/stats
```

### Acc√®s
- **R√¥le requis** : `medecin_controleur`
- **Middleware** : `auth:api`, `checkRole:medecin_controleur`

### R√©ponse
```json
{
  "success": true,
  "message": "Statistiques des questions r√©cup√©r√©es avec succ√®s",
  "data": {
    "total": 120,
    "actives": 110,
    "inactives": 10,
    "obligatoires": 85,
    "optionnelles": 35,
    "repartition_par_destinataire": {
      "prospect_physique": 50,
      "prestataire_medical": 40,
      "entreprise": 30
    },
    "repartition_par_type_donnee": {
      "text": 60,
      "select": 30,
      "number": 20,
      "date": 10
    },
    "repartition_obligatoire_par_destinataire": {
      "prospect_physique": {
        "obligatoires": 35,
        "optionnelles": 15
      },
      "prestataire_medical": {
        "obligatoires": 30,
        "optionnelles": 10
      },
      "entreprise": {
        "obligatoires": 20,
        "optionnelles": 10
      }
    }
  }
}
```

### Structure des donn√©es
| Champ | Type | Description |
|-------|------|-------------|
| `total` | integer | Nombre total de questions |
| `actives` | integer | Nombre de questions actives |
| `inactives` | integer | Nombre de questions inactives |
| `obligatoires` | integer | Nombre de questions obligatoires |
| `optionnelles` | integer | Nombre de questions optionnelles |
| `repartition_par_destinataire` | object | R√©partition par type de destinataire |
| `repartition_par_type_donnee` | object | R√©partition par type de donn√©e (text, select, number, date, etc.) |
| `repartition_obligatoire_par_destinataire` | object | R√©partition obligatoire/optionnelle par destinataire |

---

## üë• Statistiques des Clients

### Route
```
GET /clients/stats
```

### Acc√®s
- **R√¥le requis** : Tous les utilisateurs authentifi√©s
- **Middleware** : `auth:api`

### R√©ponse
```json
{
  "success": true,
  "message": "Statistiques des clients r√©cup√©r√©es avec succ√®s",
  "data": {
    "total": 150,
    "prospects": 45,
    "clients": 80,
    "assures": 25,
    "physiques": 120,
    "moraux": 30,
    "repartition_par_sexe": {
      "M": 85,
      "F": 60,
      "Non sp√©cifi√©": 5
    },
    "repartition_par_profession": {
      "M√©decin": 25,
      "Ing√©nieur": 20,
      "Avocat": 15,
      "Comptable": 12,
      "Enseignant": 10
    },
    "repartition_statut_par_type": {
      "physique": {
        "prospect": 35,
        "client": 70,
        "assure": 15
      },
      "moral": {
        "prospect": 10,
        "client": 10,
        "assure": 10
      }
    }
  }
}
```

### Structure des donn√©es
| Champ | Type | Description |
|-------|------|-------------|
| `total` | integer | Nombre total de clients |
| `prospects` | integer | Nombre de prospects |
| `clients` | integer | Nombre de clients actifs |
| `assures` | integer | Nombre d'assur√©s |
| `physiques` | integer | Nombre de clients physiques |
| `moraux` | integer | Nombre de clients moraux (entreprises) |
| `repartition_par_sexe` | object | R√©partition par sexe |
| `repartition_par_profession` | object | Top 10 des professions |
| `repartition_statut_par_type` | object | R√©partition statut par type de client |

---

## üè• Statistiques des Assur√©s

### Route
```
GET /assures/stats
```

### Acc√®s
- **R√¥le requis** : `admin_global`, `medecin_controleur`, `technicien`
- **Middleware** : `auth:api`, `checkRole:admin_global,medecin_controleur,technicien`

### R√©ponse
```json
{
  "success": true,
  "message": "Statistiques des assur√©s r√©cup√©r√©es avec succ√®s",
  "data": {
    "total": 200,
    "principaux": 80,
    "beneficiaires": 120,
    "actifs": 180,
    "inactifs": 15,
    "suspendus": 5,
    "repartition_par_sexe": {
      "M": 110,
      "F": 85,
      "Non sp√©cifi√©": 5
    },
    "repartition_par_lien_parente": {
      "principal": 80,
      "conjoint": 40,
      "enfant": 60,
      "parent": 20
    },
    "repartition_par_statut": {
      "actif": 180,
      "inactif": 15,
      "suspendu": 5
    },
    "repartition_principaux_beneficiaires": {
      "principaux": 80,
      "beneficiaires": 120
    },
    "repartition_par_contrat": {
      "Contrat 1": 25,
      "Contrat 2": 30,
      "Contrat 3": 20
    }
  }
}
```

### Structure des donn√©es
| Champ | Type | Description |
|-------|------|-------------|
| `total` | integer | Nombre total d'assur√©s |
| `principaux` | integer | Nombre d'assur√©s principaux |
| `beneficiaires` | integer | Nombre de b√©n√©ficiaires |
| `actifs` | integer | Nombre d'assur√©s actifs |
| `inactifs` | integer | Nombre d'assur√©s inactifs |
| `suspendus` | integer | Nombre d'assur√©s suspendus |
| `repartition_par_sexe` | object | R√©partition par sexe |
| `repartition_par_lien_parente` | object | R√©partition par lien de parent√© |
| `repartition_par_statut` | object | R√©partition par statut |
| `repartition_principaux_beneficiaires` | object | R√©partition principaux vs b√©n√©ficiaires |
| `repartition_par_contrat` | object | R√©partition par contrat |

---

## üìã Statistiques des Demandes d'Adh√©sion

### Route
```
GET /demandes-adhesions/stats
```

### Acc√®s
- **R√¥le requis** : `admin_global`, `medecin_controleur`, `technicien`
- **Middleware** : `auth:api`, `checkRole:admin_global,medecin_controleur,technicien`

### R√©ponse
```json
{
  "success": true,
  "message": "Statistiques des demandes d'adh√©sion r√©cup√©r√©es avec succ√®s",
  "data": {
    "total": 300,
    "en_attente": 50,
    "validees": 200,
    "rejetees": 50,
    "repartition_par_type_demandeur": {
      "physique": 150,
      "autre": 100,
      "centre_soins": 30,
      "laboratoire": 20
    },
    "repartition_par_statut": {
      "en_attente": 50,
      "validee": 200,
      "rejetee": 50
    },
    "repartition_statut_par_type": {
      "physique": {
        "en_attente": 30,
        "validee": 100,
        "rejetee": 20
      },
      "autre": {
        "en_attente": 20,
        "validee": 70,
        "rejetee": 10
      }
    },
    "demandes_par_mois": {
      "Janvier": 25,
      "F√©vrier": 30,
      "Mars": 35,
      "Avril": 40,
      "Mai": 45,
      "Juin": 50
    }
  }
}
```

### Structure des donn√©es
| Champ | Type | Description |
|-------|------|-------------|
| `total` | integer | Nombre total de demandes |
| `en_attente` | integer | Demandes en attente |
| `validees` | integer | Demandes valid√©es |
| `rejetees` | integer | Demandes rejet√©es |
| `repartition_par_type_demandeur` | object | R√©partition par type de demandeur |
| `repartition_par_statut` | object | R√©partition par statut |
| `repartition_statut_par_type` | object | R√©partition statut par type |
| `demandes_par_mois` | object | Demandes par mois (ann√©e en cours) |

---

## üé® Suggestions d'Interface Frontend

### 1. Dashboard Gestionnaire
- **Graphiques circulaires** pour la r√©partition par sexe et par r√¥le
- **Cartes de statistiques** pour les totaux, actifs, inactifs
- **Graphiques en barres** pour comparer les diff√©rents r√¥les

### 2. Dashboard Admin
- **Graphiques circulaires** pour la r√©partition par sexe des gestionnaires
- **Indicateurs cl√©s** (KPIs) pour les totaux
- **Graphiques d'√©volution** temporelle

### 3. Dashboard M√©decin Contr√¥leur
- **Graphiques en barres** pour la r√©partition par destinataire
- **Graphiques circulaires** pour les types de donn√©es
- **Tableaux d√©taill√©s** pour la r√©partition obligatoire/optionnelle
- **Indicateurs de performance** pour les questions actives/inactives

### 4. Dashboard Clients
- **Graphiques circulaires** pour la r√©partition par sexe et par type
- **Graphiques en barres** pour les professions les plus populaires
- **Indicateurs cl√©s** pour les prospects, clients, assur√©s
- **Tableaux d√©taill√©s** pour la r√©partition statut par type

### 5. Dashboard Assur√©s
- **Graphiques circulaires** pour la r√©partition par sexe et lien de parent√©
- **Graphiques en barres** pour les statuts et contrats
- **Indicateurs cl√©s** pour principaux vs b√©n√©ficiaires
- **Graphiques d'√©volution** temporelle

### 6. Dashboard Demandes d'Adh√©sion
- **Graphiques en barres** pour la r√©partition par type et statut
- **Graphiques lin√©aires** pour l'√©volution mensuelle
- **Indicateurs de performance** pour les taux de validation
- **Tableaux d√©taill√©s** pour la r√©partition crois√©e

---

## üìã Codes d'erreur possibles

### 401 - Non autoris√©
```json
{
  "success": false,
  "message": "Token d'authentification invalide ou manquant",
  "code": 401
}
```

### 403 - Acc√®s interdit
```json
{
  "success": false,
  "message": "Vous n'avez pas les permissions n√©cessaires",
  "code": 403
}
```

### 500 - Erreur serveur
```json
{
  "success": false,
  "message": "Erreur lors de la r√©cup√©ration des statistiques",
  "code": 500
}
```

---

## üîÑ Mise √† jour des donn√©es

Les statistiques sont calcul√©es en temps r√©el √† chaque requ√™te. Aucun cache n'est impl√©ment√© pour garantir la fra√Æcheur des donn√©es.

---

## üìù Notes techniques

- Toutes les routes utilisent le middleware `verifyApiKey` pour la s√©curit√©
- Les donn√©es sont group√©es et agr√©g√©es c√¥t√© base de donn√©es pour de meilleures performances
- Les r√©partitions par sexe incluent une cat√©gorie "Non sp√©cifi√©" pour les valeurs nulles
- Les r√©partitions par r√¥le sont dynamiques selon les r√¥les existants dans le syst√®me

---

## üìä Statistiques du Dashboard (Adapt√©es au R√¥le)

### Route
```
GET /dashboard/stats
```

### Acc√®s
- **R√¥le requis** : Tous les utilisateurs authentifi√©s
- **Middleware** : `auth:api`
- **Donn√©es adapt√©es** : Selon le r√¥le de l'utilisateur connect√©

### R√©ponse selon le r√¥le

#### Admin Global
```json
{
  "success": true,
  "message": "Statistiques du dashboard r√©cup√©r√©es avec succ√®s",
  "data": {
    "gestionnaires": { /* stats gestionnaires */ },
    "personnels": { /* stats personnels */ },
    "clients": { /* stats clients */ },
    "assures": { /* stats assur√©s */ },
    "demandes_adhesion": { /* stats toutes demandes */ },
    "questions": { /* stats questions */ },
    "garanties": { /* stats garanties */ },
    "categories_garanties": { /* stats cat√©gories */ }
  }
}
```

#### Gestionnaire
```json
{
  "success": true,
  "message": "Statistiques du dashboard r√©cup√©r√©es avec succ√®s",
  "data": {
    "personnels": { /* stats personnels g√©r√©s */ },
    "clients": { /* stats clients */ }
  }
}
```

#### Technicien
```json
{
  "success": true,
  "message": "Statistiques du dashboard r√©cup√©r√©es avec succ√®s",
  "data": {
    "clients": { /* stats clients */ },
    "assures": { /* stats assur√©s */ },
    "demandes_adhesion": { /* stats demandes physique/moral */ },
    "garanties": { /* stats garanties */ },
    "categories_garanties": { /* stats cat√©gories */ }
  }
}
```

#### M√©decin Contr√¥leur
```json
{
  "success": true,
  "message": "Statistiques du dashboard r√©cup√©r√©es avec succ√®s",
  "data": {
    "clients": { /* stats clients */ },
    "assures": { /* stats assur√©s */ },
    "questions": { /* stats questions */ },
    "garanties": { /* stats garanties */ },
    "categories_garanties": { /* stats cat√©gories */ },
    "demandes_adhesion": { /* stats demandes prestataires */ }
  }
}
```

### Acc√®s par r√¥le

| R√¥le | Gestionnaires | Personnels | Clients | Assur√©s | Demandes | Questions | Garanties | Cat√©gories |
|------|---------------|------------|---------|---------|----------|-----------|-----------|------------|
| **Admin Global** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ (Toutes) | ‚úÖ | ‚úÖ | ‚úÖ |
| **Gestionnaire** | ‚ùå | ‚úÖ (G√©r√©s) | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| **Technicien** | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ (Physique/Moral) | ‚ùå | ‚úÖ | ‚úÖ |
| **M√©decin Contr√¥leur** | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ (Prestataires) | ‚úÖ | ‚úÖ | ‚úÖ |

---

## üöÄ Exemples d'utilisation

### JavaScript/Fetch
```javascript
const getGestionnaireStats = async () => {
  const response = await fetch('/api/v1/admin/gestionnaires/stats', {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    }
  });
  return await response.json();
};

const getClientStats = async () => {
  const response = await fetch('/api/v1/clients/stats', {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    }
  });
  return await response.json();
};

const getAssureStats = async () => {
  const response = await fetch('/api/v1/assures/stats', {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    }
  });
  return await response.json();
};

const getDemandeAdhesionStats = async () => {
  const response = await fetch('/api/v1/demandes-adhesions/stats', {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    }
  });
  return await response.json();
};

const getDashboardStats = async () => {
  const response = await fetch('/api/v1/dashboard/stats', {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    }
  });
  return await response.json();
};
```

### Axios
```javascript
const getPersonnelStats = async () => {
  const response = await axios.get('/api/v1/gestionnaire/personnels/stats', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  return response.data;
};
``` 